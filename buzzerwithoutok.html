<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study Buddy Portal</title>
<style>
  /* üåå Animated Night Gradient Background */
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(270deg, #0f2027, #203a43, #2c5364, #1e3c72);
    background-size: 600% 600%;
    animation: gradientBG 14s ease infinite;
    margin: 0;
    padding: 0;
    color: #e8ecf1;
  }
  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .container {
    max-width: 720px;
    background: rgba(30, 30, 40, 0.95);
    margin: 50px auto;
    padding: 30px;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
    transition: transform 0.3s ease, box-shadow 0.3s;
    color: #f5f7fa;
  }
  .container:hover { transform: scale(1.01); box-shadow: 0 12px 35px rgba(0,0,0,0.6); }

  h1, h2, h3 {
    text-align: center;
    background: linear-gradient(to right, #7f7fd5, #86a8e7, #91eae4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
    color: #cdd9f7;
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #555;
    background: #1c1f2b;
    color: #e0e6ef;
    transition: 0.3s;
  }
  input:focus, select:focus { border-color: #7f7fd5; box-shadow: 0 0 10px #86a8e7; outline: none; }

  button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(90deg, #7f7fd5, #86a8e7, #91eae4);
    color: #121212;
    border: none;
    border-radius: 10px;
    font-size: 17px;
    font-weight: bold;
    margin-top: 18px;
    cursor: pointer;
    transition: background 0.4s, transform 0.2s, box-shadow 0.2s;
  }
  button:hover {
    background: linear-gradient(90deg, #91eae4, #86a8e7, #7f7fd5);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(145,234,228,0.4);
  }

  .hidden { display: none; }
  .output {
    margin-top: 25px;
    padding: 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    border: 1px solid #555;
    box-shadow: 0 0 10px rgba(255,255,255,0.05);
  }
  .survey {
    background: rgba(80, 90, 130, 0.25);
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #4c5a7a;
    margin-top: 20px;
    box-shadow: 0 0 10px rgba(140,170,255,0.3);
  }

  .logout {
    background: linear-gradient(90deg, #ff416c, #ff4b2b);
    color: white;
  }
  .logout:hover {
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    box-shadow: 0 5px 15px rgba(255,65,108,0.4);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 12px;
    overflow: hidden;
  }
  th {
    background: linear-gradient(90deg, #7f7fd5, #86a8e7);
    color: #fff;
    padding: 10px;
  }
  td {
    padding: 10px;
    border-bottom: 1px solid #333;
    color: #e0e6ef;
  }
  tr:nth-child(even) { background: rgba(255,255,255,0.05); }
  tr:hover { background: rgba(255,255,255,0.1); }
</style>
</head>
<body>

<!-- üîî AUDIO BUZZER -->
<audio id="buzzerSound">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<!-- üéì LOGIN PAGE -->
<div class="container" id="loginPage">
  <h1>üéì Smart Study Buddy</h1>
  <h3>Login as Student or Admin</h3>

  <label>Role:</label>
  <select id="roleSelect" onchange="toggleRole()">
    <option value="student">Student</option>
    <option value="admin">Admin</option>
  </select>

  <div id="studentFields">
    <label>Name:</label>
    <input type="text" id="loginName" placeholder="Enter your full name" />
    <label>Institution:</label>
    <input type="text" id="institution" placeholder="Enter your school or college" />
    <label>Branch / Course:</label>
    <select id="branch">
      <option value="">Select Branch</option>
      <option value="CSE">Computer Science</option>
      <option value="ECE">Electronics</option>
      <option value="MECH">Mechanical</option>
      <option value="CIVIL">Civil</option>
    </select>
  </div>

  <label>Password:</label>
  <input type="password" id="loginPassword" placeholder="Enter password" />
  <button onclick="login()">Login</button>
</div>

<!-- üìò STUDENT PAGE -->
<div class="container hidden" id="studyPage">
  <h1>üìò Study Planner</h1>
  <p id="welcomeMsg"></p>

  <label>Semester:</label>
  <select id="semesterSelect" onchange="loadSubjects()">
    <option value="sem1">Semester 1</option>
    <option value="sem2">Semester 2</option>
    <option value="sem3">Semester 3</option>
    <option value="sem4">Semester 4</option>
    <option value="sem5">Semester 5</option>
  </select>

  <label>Subjects:</label>
  <div id="subjectList"></div>

  <label>Total Study Time (in Minutes):</label>
  <input type="number" id="totalMinutes" placeholder="Enter total study time in minutes" />
  <button onclick="saveStudyData()">üïí Distribute & Save Study Record</button>

  <div id="output" class="output hidden"></div>

  <div class="survey">
    <h3>üìä Survey Result</h3>
    <p id="surveyResult">Loading...</p>
  </div>

  <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- üë©‚Äçüíº ADMIN PAGE -->
<div class="container hidden" id="adminPage">
  <h1>üë©‚Äçüíº Admin Dashboard</h1>
  <h3>Study Survey Overview</h3>
  <div id="adminSurvey"></div>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<script>
const subjectOptions = {
  CSE: {
    sem1: ["Engineering Mathematics", "Physics", "Chemistry", "CF", "BEEE", "English"],
    sem2: ["Engineering Mathematics", "Physics", "Chemistry", "Web Technologies", "English", "C Programming"],
    sem3: ["Engineering Mathematics", "COA", "Data Structure", "C++", "OS", "Computer Networks"],
    sem4: ["Engineering Mathematics", "RDBMS", "Software Engineering", "Microprocessor", "Python", "OS"],
    sem5: ["Java", "Computer Security", "Data Communication", "Mobile App Development", "IME", "Elective (AI/ML/Cloud)"]
  }
};

function toggleRole() {
  const role = document.getElementById("roleSelect").value;
  document.getElementById("studentFields").style.display = role === "student" ? "block" : "none";
}

function login() {
  const role = document.getElementById("roleSelect").value;
  const password = document.getElementById("loginPassword").value;
  if (role === "admin") {
    if (password === "admin123") loadAdminPage();
    else alert("Invalid admin password!");
    return;
  }
  const name = document.getElementById("loginName").value.trim();
  const inst = document.getElementById("institution").value.trim();
  const branch = document.getElementById("branch").value;
  if (!name || !inst || !branch || !password) {
    alert("Please fill all student fields!");
    return;
  }
  localStorage.setItem("currentStudent", JSON.stringify({ name, inst, branch }));
  loadStudyPage();
}

function loadStudyPage() {
  document.getElementById("loginPage").classList.add("hidden");
  document.getElementById("studyPage").classList.remove("hidden");
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  document.getElementById("welcomeMsg").innerHTML = `Welcome, <b>${student.name}</b> (${student.branch})`;
  loadSubjects();
  showSurvey();
}

function loadSubjects() {
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  const sem = document.getElementById("semesterSelect").value;
  const subjectDiv = document.getElementById("subjectList");
  subjectDiv.innerHTML = "";
  subjectOptions[student.branch][sem].forEach(s => {
    const div = document.createElement("div");
    div.innerHTML = `<input type="checkbox" value="${s}"> ${s}`;
    subjectDiv.appendChild(div);
  });
}

let timerInterval = null;
function saveStudyData() {
  const student = JSON.parse(localStorage.getItem("currentStudent"));
  const selected = [...document.querySelectorAll("#subjectList input:checked")].map(cb => cb.value);
  const totalMinutes = parseFloat(document.getElementById("totalMinutes").value);
  if (selected.length === 0 || isNaN(totalMinutes) || totalMinutes <= 0) {
    alert("Select subjects and enter valid time!");
    return;
  }
  const minsPer = (totalMinutes / selected.length).toFixed(2);
  const hrsPer = (minsPer / 60).toFixed(2);
  let studyData = JSON.parse(localStorage.getItem("studyData") || "[]");
  selected.forEach(sub => studyData.push({ name: student.name, branch: student.branch, subject: sub, hours: parseFloat(hrsPer), minutes: parseFloat(minsPer) }));
  localStorage.setItem("studyData", JSON.stringify(studyData));
  document.getElementById("output").innerHTML =
    `<b>Study Time Distributed:</b><br>${selected.map(s => `${s} ‚Äî ${hrsPer} hr (${minsPer} min)`).join("<br>")}
    <br><br><b>‚è±Ô∏è Timer started for ${totalMinutes} minutes...</b><br><span id='timerDisplay'></span>`;
  document.getElementById("output").classList.remove("hidden");
  startTimer(totalMinutes);
  showSurvey();
}

function startTimer(totalMinutes) {
  clearInterval(timerInterval);
  let remaining = totalMinutes * 60;
  const buzzer = document.getElementById("buzzerSound");
  timerInterval = setInterval(() => {
    remaining--;
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    document.getElementById("timerDisplay").innerText = `Time Remaining: ${m}m ${s}s`;
    if (remaining <= 0) {
      clearInterval(timerInterval);
      buzzer.play(); // ‚úÖ Play sound instantly
      document.getElementById("timerDisplay").innerText = "‚úÖ Study session completed!";
      alert(`‚è∞ Your study time of ${totalMinutes} minutes is completed!`);
    }
  }, 1000);
}

function showSurvey() {
  const data = JSON.parse(localStorage.getItem("studyData") || "[]");
  if (data.length === 0) { document.getElementById("surveyResult").innerText = "No data yet."; return; }
  const count = {};
  data.forEach(d => count[d.subject] = (count[d.subject] || 0) + d.hours);
  const top = Object.keys(count).reduce((a,b)=>count[a]>count[b]?a:b);
  document.getElementById("surveyResult").innerText = `Most studied subject: ${top} (${count[top]} hrs total)`;
}

function loadAdminPage() {
  document.getElementById("loginPage").classList.add("hidden");
  document.getElementById("adminPage").classList.remove("hidden");
  const data = JSON.parse(localStorage.getItem("studyData") || "[]");
  if (data.length === 0) { document.getElementById("adminSurvey").innerHTML = "<p>No study records found.</p>"; return; }
  const sum = {};
  data.forEach(d => {
    if (!sum[d.subject]) sum[d.subject] = { h: 0, m: 0 };
    sum[d.subject].h += d.hours; sum[d.subject].m += d.minutes;
  });
  let html = "<table><tr><th>Subject</th><th>Total Hours</th><th>Total Minutes</th></tr>";
  for (let [s,v] of Object.entries(sum)) html += `<tr><td>${s}</td><td>${v.h.toFixed(2)}</td><td>${v.m.toFixed(2)}</td></tr>`;
  html += "</table>";
  document.getElementById("adminSurvey").innerHTML = html;
}

function logout() {
  clearInterval(timerInterval);
  localStorage.removeItem("currentStudent");
  document.getElementById("loginPage").classList.remove("hidden");
  document.getElementById("studyPage").classList.add("hidden");
  document.getElementById("adminPage").classList.add("hidden");
}

window.onload = () => { if (localStorage.getItem("currentStudent")) loadStudyPage(); };
</script>
</body>
</html>
